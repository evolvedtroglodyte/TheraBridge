{% extends "base.html" %}

{% block title %}Treatment Summary - {{ patient.full_name }}{% endblock %}

{% block header %}
<h1>Treatment Summary</h1>
<p><strong>Patient:</strong> {{ patient.full_name }}</p>
{% if treatment_plan_id %}
<p><strong>Treatment Plan ID:</strong> {{ treatment_plan_id }}</p>
{% endif %}
<p><strong>Purpose:</strong> {{ purpose|capitalize }}</p>
<p><strong>Prepared by:</strong> {{ therapist.full_name }}{% if therapist.credentials %}, {{ therapist.credentials }}{% endif %}</p>
<p><strong>Date:</strong> {{ generated_at.strftime('%B %d, %Y') }}</p>
{% endblock %}

{% block content %}
{% if include_sections.diagnosis %}
<div class="section">
    <div class="section-title">Diagnosis</div>
    {% if diagnoses and diagnoses|length > 0 %}
    <table>
        <thead>
            <tr>
                <th>ICD-10 Code</th>
                <th>Description</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for diagnosis in diagnoses %}
            <tr>
                <td>{{ diagnosis.code }}</td>
                <td>{{ diagnosis.description }}</td>
                <td>{{ diagnosis.status|default('Active') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No diagnoses recorded.</p>
    {% endif %}
</div>
{% endif %}

{% if include_sections.treatment_plan %}
<div class="section">
    <div class="section-title">Treatment Plan</div>

    {% if treatment_goals and treatment_goals|length > 0 %}
    <p><strong>Treatment Goals:</strong></p>
    <ul>
        {% for goal in treatment_goals %}
        <li>{{ goal.description }}{% if goal.target_date %} (Target: {{ goal.target_date.strftime('%B %d, %Y') }}){% endif %}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if treatment_modalities and treatment_modalities|length > 0 %}
    <p><strong>Treatment Modalities:</strong></p>
    <ul>
        {% for modality in treatment_modalities %}
        <li>{{ modality }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if session_frequency %}
    <p><strong>Session Frequency:</strong> {{ session_frequency }}</p>
    {% endif %}

    {% if estimated_duration %}
    <p><strong>Estimated Treatment Duration:</strong> {{ estimated_duration }}</p>
    {% endif %}
</div>
{% endif %}

{% if include_sections.interventions_used %}
<div class="section">
    <div class="section-title">Interventions Used</div>
    {% if interventions and interventions|length > 0 %}
    <table>
        <thead>
            <tr>
                <th>Intervention</th>
                <th>Frequency</th>
                <th>Effectiveness</th>
            </tr>
        </thead>
        <tbody>
            {% for intervention in interventions %}
            <tr>
                <td>{{ intervention.name }}</td>
                <td>{{ intervention.frequency|default('N/A') }}</td>
                <td>{{ intervention.effectiveness|default('N/A') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No interventions recorded.</p>
    {% endif %}
</div>
{% endif %}

{% if include_sections.progress_summary %}
<div class="section">
    <div class="section-title">Progress Summary</div>

    {% if treatment_start_date %}
    <p><strong>Treatment Start Date:</strong> {{ treatment_start_date.strftime('%B %d, %Y') }}</p>
    {% endif %}

    {% if total_sessions %}
    <p><strong>Total Sessions Completed:</strong> {{ total_sessions }}</p>
    {% endif %}

    {% if progress_narrative %}
    <p><strong>Overall Progress:</strong></p>
    <p style="margin-left: 20px;">{{ progress_narrative }}</p>
    {% endif %}

    {% if goal_achievements and goal_achievements|length > 0 %}
    <p><strong>Goal Achievements:</strong></p>
    <ul>
        {% for achievement in goal_achievements %}
        <li>{{ achievement }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if challenges and challenges|length > 0 %}
    <p><strong>Treatment Challenges:</strong></p>
    <ul>
        {% for challenge in challenges %}
        <li>{{ challenge }}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endif %}

{% if include_sections.prognosis %}
<div class="section">
    <div class="section-title">Clinical Prognosis & Recommendations</div>

    {% if prognosis %}
    <p><strong>Prognosis:</strong> {{ prognosis }}</p>
    {% endif %}

    {% if continuing_care_recommendations and continuing_care_recommendations|length > 0 %}
    <p><strong>Continuing Care Recommendations:</strong></p>
    <ul>
        {% for recommendation in continuing_care_recommendations %}
        <li>{{ recommendation }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if discharge_recommendations and discharge_recommendations|length > 0 %}
    <p><strong>Discharge Recommendations:</strong></p>
    <ul>
        {% for recommendation in discharge_recommendations %}
        <li>{{ recommendation }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if follow_up_plan %}
    <p><strong>Follow-Up Plan:</strong></p>
    <p style="margin-left: 20px;">{{ follow_up_plan }}</p>
    {% endif %}
</div>
{% endif %}

{% if include_sections.insurance_information %}
<div class="section">
    <div class="section-title">Insurance & Billing Information</div>

    {% if cpt_codes and cpt_codes|length > 0 %}
    <p><strong>CPT Codes Used:</strong></p>
    <table>
        <thead>
            <tr>
                <th>CPT Code</th>
                <th>Description</th>
                <th>Sessions</th>
            </tr>
        </thead>
        <tbody>
            {% for cpt in cpt_codes %}
            <tr>
                <td>{{ cpt.code }}</td>
                <td>{{ cpt.description }}</td>
                <td>{{ cpt.session_count|default('N/A') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    {% if medical_necessity %}
    <p><strong>Medical Necessity Statement:</strong></p>
    <p style="margin-left: 20px;">{{ medical_necessity }}</p>
    {% endif %}
</div>
{% endif %}

{% if include_sections.clinical_notes %}
<div class="section">
    <div class="section-title">Additional Clinical Notes</div>
    {% if clinical_notes %}
    <p>{{ clinical_notes }}</p>
    {% else %}
    <p>No additional clinical notes.</p>
    {% endif %}
</div>
{% endif %}

<div class="section" style="margin-top: 40px; border-top: 1px solid #ddd; padding-top: 20px;">
    <p><strong>Therapist Signature:</strong></p>
    <p>{{ therapist.full_name }}{% if therapist.credentials %}, {{ therapist.credentials }}{% endif %}</p>
    <p>{{ generated_at.strftime('%B %d, %Y') }}</p>
</div>
{% endblock %}
