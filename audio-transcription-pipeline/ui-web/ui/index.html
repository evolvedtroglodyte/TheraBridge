<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Audio diarization pipeline for identifying and separating different speakers in audio recordings">
    <title>Audio Diarization Pipeline</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="results-styles.css">
    <link rel="stylesheet" href="ux-styles.css">
    <!-- WaveSurfer.js for waveform visualization -->
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body data-theme="dark">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                    <line x1="12" y1="19" x2="12" y2="23"/>
                    <line x1="8" y1="23" x2="16" y2="23"/>
                </svg>
                Audio Diarization Pipeline
            </h1>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Upload Section -->
            <section class="upload-section" id="uploadSection">
                <div class="upload-card">
                    <h2 class="section-title">Upload Audio File</h2>
                    <p class="section-description">
                        Upload your audio recording to identify and separate different speakers
                    </p>

                    <!-- Drag & Drop Area -->
                    <div class="drop-zone" id="dropZone" role="button" tabindex="0" aria-label="Upload audio file area. Click or press Enter to select a file, or drag and drop a file here.">
                        <input
                            type="file"
                            id="fileInput"
                            accept=".mp3,.wav,.m4a,.aac,.ogg,.flac,.wma,.aiff"
                            aria-label="Audio file upload input"
                            hidden
                        >

                        <div class="drop-zone-content" id="dropZoneContent">
                            <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            <p class="drop-zone-text">
                                <strong>Drag and drop</strong> your audio file here
                            </p>
                            <p class="drop-zone-subtext">or</p>
                            <button class="btn btn-primary" id="browseBtn">
                                Browse Files
                            </button>
                            <p class="file-types">
                                Supported formats: MP3, WAV, M4A, AAC, OGG, FLAC, WMA, AIFF
                            </p>
                        </div>

                        <!-- File Info (hidden initially) -->
                        <div class="file-info" id="fileInfo" style="display: none;">
                            <div class="file-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 18V5l12-2v13"/>
                                    <circle cx="6" cy="18" r="3"/>
                                    <circle cx="18" cy="16" r="3"/>
                                </svg>
                            </div>
                            <div class="file-details">
                                <p class="file-name" id="fileName"></p>
                                <p class="file-meta">
                                    <span id="fileSize"></span>
                                    <span class="separator">•</span>
                                    <span id="fileDuration">Calculating duration...</span>
                                </p>
                            </div>
                            <button class="btn-icon" id="removeFileBtn" aria-label="Remove file">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- GPU Status Indicator -->
                    <div class="gpu-status-container" id="gpuStatusContainer">
                        <div class="gpu-status" id="gpuStatus">
                            <span class="gpu-status-icon" id="gpuStatusIcon">⚡</span>
                            <span class="gpu-status-text" id="gpuStatusText">Checking GPU...</span>
                        </div>
                    </div>

                    <!-- Upload Button -->
                    <button class="btn btn-success btn-large" id="uploadBtn" disabled aria-label="Process audio file. Upload and start transcription and speaker identification.">
                        <svg class="btn-icon-left" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Process Audio
                    </button>
                </div>
            </section>

            <!-- Processing Section (hidden initially) -->
            <section class="processing-section" id="processingSection" style="display: none;" role="status" aria-live="polite" aria-atomic="true">
                <div class="processing-card">
                    <div class="processing-header">
                        <h2 class="section-title">Processing Audio</h2>
                        <div class="processing-spinner" role="presentation" aria-label="Processing indicator"></div>
                    </div>

                    <div class="progress-container">
                        <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Processing progress">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p class="progress-text" id="progressText" aria-live="polite">0%</p>
                    </div>

                    <div class="processing-steps">
                        <div class="step" id="step1">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="step-content">
                                <p class="step-title">Uploading file</p>
                                <p class="step-status">Pending...</p>
                            </div>
                        </div>
                        <div class="step" id="step2">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="step-content">
                                <p class="step-title">Transcribing audio</p>
                                <p class="step-status">Waiting...</p>
                            </div>
                        </div>
                        <div class="step" id="step3">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="step-content">
                                <p class="step-title">Identifying speakers</p>
                                <p class="step-status">Waiting...</p>
                            </div>
                        </div>
                        <div class="step" id="step4">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="step-content">
                                <p class="step-title">Generating results</p>
                                <p class="step-status">Waiting...</p>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-secondary" id="cancelBtn" aria-label="Cancel audio processing. This will stop the current operation.">
                        Cancel Processing
                    </button>
                </div>
            </section>

            <!-- Results Section (hidden initially) -->
            <section id="resultsContainer" class="results-section" style="display: none;">
                <!-- Results Header -->
                <div class="results-header">
                    <h2>Diarization Results</h2>
                    <div class="results-actions">
                        <!-- Export Dropdown -->
                        <div class="export-dropdown">
                            <button id="exportMenuBtn" class="dropdown-toggle">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Export
                                <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                            <div id="exportMenu" class="dropdown-menu hidden">
                                <button class="dropdown-item" data-export="pdf">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                    </svg>
                                    Export as PDF
                                    <span class="shortcut-hint">Ctrl+S</span>
                                </button>
                                <button class="dropdown-item" data-export="txt">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="12" y1="18" x2="12" y2="12"/>
                                        <line x1="9" y1="15" x2="15" y2="15"/>
                                    </svg>
                                    Export as TXT
                                    <span class="shortcut-hint">Ctrl+T</span>
                                </button>
                                <button class="dropdown-item" data-export="csv">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                                        <line x1="3" y1="9" x2="21" y2="9"/>
                                        <line x1="9" y1="21" x2="9" y2="9"/>
                                    </svg>
                                    Export as CSV
                                    <span class="shortcut-hint">Ctrl+C</span>
                                </button>
                                <button class="dropdown-item" data-export="json">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                    </svg>
                                    Export as JSON
                                    <span class="shortcut-hint">Ctrl+J</span>
                                </button>
                            </div>
                        </div>
                        <button id="newUploadBtn" class="primary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            New Upload
                        </button>
                    </div>
                </div>

                <!-- Speaker Timeline -->
                <div class="timeline-section">
                    <h3>Speaker Timeline</h3>
                    <div class="timeline-container">
                        <canvas id="timelineCanvas"></canvas>
                    </div>
                    <div id="segmentTooltip" class="segment-tooltip hidden"></div>
                </div>

                <!-- Waveform Visualization -->
                <div class="waveform-section">
                    <h3>Audio Waveform</h3>
                    <div id="waveformContainer"></div>
                    <div id="waveformError"></div>
                    <div class="waveform-controls">
                        <button id="playBtn" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                            Play
                        </button>
                        <button id="stopBtn" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="6" y="6" width="12" height="12"/>
                            </svg>
                            Stop
                        </button>
                        <button id="zoomInBtn" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <line x1="11" y1="8" x2="11" y2="14"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                            Zoom In
                        </button>
                        <button id="zoomOutBtn" disabled>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <line x1="8" y1="11" x2="14" y2="11"/>
                            </svg>
                            Zoom Out
                        </button>
                        <span class="playback-time" id="playbackTime">00:00 / 00:00</span>
                    </div>
                </div>

                <!-- Processing Metrics -->
                <div class="metrics-section">
                    <h3>Processing Metrics</h3>
                    <div id="processingMetrics"></div>
                </div>

                <!-- Results Grid: Transcript + Speaker Stats -->
                <div class="results-grid">
                    <!-- Transcript Display -->
                    <div class="transcript-section">
                        <h3>Speaker-Labeled Transcript</h3>
                        <div id="transcriptDisplay"></div>
                    </div>

                    <!-- Speaker Statistics -->
                    <div class="stats-section">
                        <h3>Speaker Statistics</h3>
                        <div id="speakerStats"></div>
                        <div id="speakerChart"></div>
                    </div>
                </div>
            </section>

            <!-- Error Display -->
            <div class="error-banner" id="errorBanner" style="display: none;">
                <div class="error-content">
                    <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <p class="error-message" id="errorMessage"></p>
                </div>
                <button class="btn-icon" id="closeErrorBtn" aria-label="Close error">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Instructions</h3>
                    <ul>
                        <li>Upload an audio file containing multiple speakers</li>
                        <li>Wait for processing to complete (typically 2-5 minutes)</li>
                        <li>Review the speaker-separated transcript</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Tips</h3>
                    <ul>
                        <li>Use clear, high-quality audio for best results</li>
                        <li>Supported file size: up to 200MB</li>
                        <li>Longer files take more time to process</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>About</h3>
                    <p>
                        This tool uses advanced AI to automatically identify different speakers
                        in your audio recordings and separate their speech into a readable transcript.
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Audio Diarization Pipeline. Part of TherapyBridge.</p>
            </div>
        </div>
    </footer>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" class="modal hidden">
        <div class="modal-overlay" id="shortcutsModalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Keyboard Shortcuts</h3>
                <button id="closeShortcutsBtn" class="btn-icon" aria-label="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>Space</kbd> <span class="or">or</span> <kbd>K</kbd>
                        </div>
                        <div class="shortcut-desc">Play/Pause</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>←</kbd>
                        </div>
                        <div class="shortcut-desc">Skip back 5 seconds</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>→</kbd>
                        </div>
                        <div class="shortcut-desc">Skip forward 5 seconds</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>J</kbd>
                        </div>
                        <div class="shortcut-desc">Skip back 10 seconds</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>L</kbd>
                        </div>
                        <div class="shortcut-desc">Skip forward 10 seconds</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>M</kbd>
                        </div>
                        <div class="shortcut-desc">Toggle mute</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>0</kbd> - <kbd>9</kbd>
                        </div>
                        <div class="shortcut-desc">Jump to 0%-90% of audio</div>
                    </div>
                    <div class="shortcut-divider"></div>
                    <div class="shortcut-section-title">Export Shortcuts</div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>Ctrl</kbd> + <kbd>S</kbd>
                        </div>
                        <div class="shortcut-desc">Export as PDF</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>Ctrl</kbd> + <kbd>T</kbd>
                        </div>
                        <div class="shortcut-desc">Export as TXT</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>Ctrl</kbd> + <kbd>C</kbd>
                        </div>
                        <div class="shortcut-desc">Export as CSV</div>
                    </div>
                    <div class="shortcut-item">
                        <div class="shortcut-keys">
                            <kbd>Ctrl</kbd> + <kbd>J</kbd>
                        </div>
                        <div class="shortcut-desc">Export as JSON</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- UX Enhancement Modules -->
    <script src="js/error-handler.js"></script>
    <script src="js/toast-notifications.js"></script>
    <script src="js/loading-states.js"></script>
    <script src="js/confirm-dialog.js"></script>
    <script src="js/performance-monitor.js"></script>
    <script src="js/ux-manager.js"></script>

    <!-- GPU Management Module -->
    <script src="js/gpu-manager.js"></script>

    <!-- Core Application Modules -->
    <script src="js/export.js"></script>
    <script src="js/player.js"></script>
    <script src="js/timeline.js"></script>
    <script src="js/player-integration.js"></script>
    <script src="js/waveform.js"></script>
    <script src="js/results.js"></script>
    <script src="js/results-integration.js"></script>
    <script src="app.js"></script>
</body>
</html>
