# Export Functionality Documentation

## Overview

The Audio Diarization Pipeline UI now includes professional export functionality with multiple format options. All exports include comprehensive metadata, speaker statistics, and formatted transcripts suitable for clinical and business use.

## Supported Export Formats

### 1. PDF Export (Recommended for Reports)
**Format:** Professional multi-page PDF document
**Use Case:** Client reports, documentation, archival
**Keyboard Shortcut:** `Ctrl+S` (or `Cmd+S` on Mac)

**Features:**
- Professional header with TherapyBridge branding
- Metadata section (filename, date, speakers, duration)
- Speaker statistics table
- Color-coded speaker labels matching the UI
- Full speaker-labeled transcript
- Processing metrics footer
- Page numbers
- Automatic page breaks

**Layout:**
```
Page 1:
┌─────────────────────────────────────────────┐
│ AUDIO TRANSCRIPTION REPORT                  │
│─────────────────────────────────────────────│
│ Metadata:                                   │
│   Audio File: therapy-session.mp3           │
│   Date: 2025-12-20 14:30:00                 │
│   Speakers: 2                               │
│   Segments: 45                              │
│                                             │
│ Speaker Statistics:                         │
│   Speaker    Turns  Duration  Words  Avg    │
│   Therapist  23     12m 34s   1,245  32.7s  │
│   Client     22     10m 56s   1,089  29.8s  │
│                                             │
│ Speaker-Labeled Transcript:                 │
│   [Therapist] [00:00 - 00:12]:             │
│   Hello, how are you feeling today?         │
│                                             │
│   [Client] [00:13 - 00:28]:                │
│   I've been feeling a bit anxious...        │
└─────────────────────────────────────────────┘
```

---

### 2. Enhanced TXT Export (Plain Text)
**Format:** Formatted plain text with ASCII art headers
**Use Case:** Email attachments, simple documentation, text editors
**Keyboard Shortcut:** `Ctrl+T` (or `Cmd+T` on Mac)

**Features:**
- ASCII art header and footer
- Metadata section with alignment
- Speaker statistics table (text-formatted)
- Full transcript with speaker labels and timestamps
- Processing metrics
- Cross-platform compatible

**Sample Output:**
```
═══════════════════════════════════════════════════════════
           AUDIO TRANSCRIPTION REPORT
═══════════════════════════════════════════════════════════

METADATA
───────────────────────────────────────────────────────────
Audio File:         therapy-session.mp3
Date Generated:     12/20/2025, 2:30:00 PM
Number of Speakers: 2
Total Segments:     45
Audio Duration:     23m 30s
Processing Time:    3m 45s

SPEAKER STATISTICS
───────────────────────────────────────────────────────────
Speaker         Turns      Duration        Words      Avg Turn
───────────────────────────────────────────────────────────
Therapist       23         12m 34s         1245       32.7s
Client          22         10m 56s         1089       29.8s

SPEAKER-LABELED TRANSCRIPT
───────────────────────────────────────────────────────────

Therapist [00:00 - 00:12]:
Hello, how are you feeling today?

Client [00:13 - 00:28]:
I've been feeling a bit anxious lately...

═══════════════════════════════════════════════════════════
Generated by TherapyBridge Audio Diarization Pipeline
═══════════════════════════════════════════════════════════
```

---

### 3. CSV Export (Data Analysis)
**Format:** Excel-compatible CSV
**Use Case:** Data analysis, spreadsheet import, research
**Keyboard Shortcut:** `Ctrl+C` (or `Cmd+C` on Mac)

**Features:**
- Structured data format
- Excel-compatible (UTF-8 with BOM)
- Quote-escaped text fields
- Timestamp formatting

**Columns:**
1. **Speaker** - Speaker label (e.g., "Therapist", "Client")
2. **Start Time** - Segment start (MM:SS or HH:MM:SS)
3. **End Time** - Segment end (MM:SS or HH:MM:SS)
4. **Duration** - Segment duration in seconds
5. **Text** - Full transcript text
6. **Word Count** - Number of words in segment

**Sample CSV:**
```csv
Speaker,Start Time,End Time,Duration,Text,Word Count
"Therapist","00:00","00:12","12.34","Hello, how are you feeling today?","7"
"Client","00:13","00:28","15.67","I've been feeling a bit anxious lately.","8"
"Therapist","00:29","00:45","16.23","Can you tell me more about that?","7"
```

**Import to Excel/Google Sheets:**
1. Open Excel/Sheets
2. File → Import → CSV
3. Select UTF-8 encoding
4. All columns will be properly formatted

---

### 4. JSON Export (Machine-Readable)
**Format:** Structured JSON with metadata
**Use Case:** API integration, programmatic processing
**Keyboard Shortcut:** `Ctrl+J` (or `Cmd+J` on Mac)

**Features:**
- Complete results data
- Added metadata wrapper
- Pretty-printed (2-space indent)
- Includes export timestamp

**Structure:**
```json
{
  "metadata": {
    "filename": "therapy-session.mp3",
    "exportDate": "2025-12-20T14:30:00.000Z",
    "speakerCount": 2,
    "segmentCount": 45
  },
  "results": {
    "aligned_transcript": [
      {
        "speaker": "SPEAKER_00",
        "text": "Hello, how are you feeling today?",
        "start": 0.0,
        "end": 12.34
      }
    ],
    "performance": {
      "total_time": 225.5,
      "audio_duration": 1410.0,
      "transcription_time": 123.4,
      "diarization_time": 89.2,
      "alignment_time": 12.9,
      "rtf": 0.16,
      "num_segments": 45,
      "num_speakers": 2
    }
  }
}
```

---

## Usage

### Via Export Menu (Mouse)
1. Process an audio file
2. View results
3. Click the "Export" button (dropdown)
4. Select desired format:
   - Export as PDF
   - Export as TXT
   - Export as CSV
   - Export as JSON

### Via Keyboard Shortcuts (Fast)
When viewing results, press:
- **Ctrl+S** → Export as PDF
- **Ctrl+T** → Export as TXT
- **Ctrl+C** → Export as CSV
- **Ctrl+J** → Export as JSON

**Mac Users:** Use `Cmd` instead of `Ctrl`

### View Shortcuts
Press the keyboard icon (⌨) in the audio controls section to see all available shortcuts.

---

## File Naming Convention

All exports use a standardized naming format:

```
{original_filename}_transcript_{timestamp}.{extension}
```

**Examples:**
- `therapy-session_transcript_2025-12-20T14-30-00.pdf`
- `therapy-session_transcript_2025-12-20T14-30-00.txt`
- `therapy-session_transcript_2025-12-20T14-30-00.csv`
- `therapy-session_transcript_2025-12-20T14-30-00.json`

The timestamp format ensures:
- Files are sortable chronologically
- No filename collisions
- Easy identification of export date

---

## Technical Implementation

### Dependencies
- **jsPDF 2.5.1** - PDF generation (loaded via CDN)
- **Native File API** - TXT/CSV/JSON downloads
- **Custom ExportManager class** - Centralized export logic

### Browser Compatibility
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

### File Size Estimates
For a typical 30-minute session with 50 segments:
- **PDF:** ~150-300 KB (depends on transcript length)
- **TXT:** ~20-50 KB
- **CSV:** ~15-40 KB
- **JSON:** ~30-80 KB

---

## Color Coding

Speaker colors are consistent across all export formats:

| Speaker ID   | Label     | Color (PDF) | Hex Code |
|-------------|-----------|-------------|----------|
| SPEAKER_00  | Therapist | Blue        | #3B82F6  |
| SPEAKER_01  | Client    | Green       | #10B981  |
| SPEAKER_02  | Observer  | Amber       | #F59E0B  |
| SPEAKER_03  | Speaker 4 | Red         | #EF4444  |
| SPEAKER_04+ | Dynamic   | Varied      | Various  |

---

## Best Practices

### For Clinical Use (HIPAA Compliance)
1. **Always use PDF** for official documentation
2. Store exported files in HIPAA-compliant storage
3. Include patient consent for recordings
4. Redact sensitive information before sharing

### For Analysis
1. **Use CSV** for quantitative analysis (turn-taking, word counts)
2. Import into R, Python, or Excel for visualization
3. **Use JSON** for automated processing pipelines

### For Sharing
1. **PDF** for clients or supervisors (professional appearance)
2. **TXT** for email or simple text editors
3. **CSV** for researchers or data teams

---

## Troubleshooting

### PDF Export Issues

**Problem:** PDF library not loaded
**Solution:** Refresh the page and try again. Check internet connection (jsPDF loads from CDN).

**Problem:** PDF doesn't include all pages
**Solution:** This is normal for long transcripts. Use PDF reader's search function to find content.

### Large File Exports

**Problem:** Browser hangs during export
**Solution:** For sessions >2 hours, consider:
1. Splitting the audio file before processing
2. Using CSV/JSON instead of PDF (smaller file size)
3. Exporting only specific speaker turns

### Character Encoding

**Problem:** Special characters appear incorrectly
**Solution:**
- CSV: Ensure "UTF-8" encoding when opening in Excel
- TXT: Use a modern text editor (VS Code, Notepad++, not Notepad)

---

## Future Enhancements

Planned features for future releases:
- [ ] DOCX export (Microsoft Word format)
- [ ] Selective export (export only specific speakers)
- [ ] Custom PDF templates
- [ ] Export to cloud storage (Google Drive, Dropbox)
- [ ] Email export directly from UI
- [ ] Batch export (multiple formats at once)

---

## Support

For issues or feature requests:
1. Check the keyboard shortcuts modal (⌨ button)
2. Review this documentation
3. Contact TherapyBridge support

**Version:** 3.0.0
**Last Updated:** December 2025
